#!/usr/bin/env bash
set -eo pipefail

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

date_format='%B %d, %Y'

notes=$(find ./provider/notes -type f -exec basename {} \; |  cut -d'.' -f1 | sort)

get_meta_field() {
  metadata="$("$DIR/parse_metadata" "$DIR/../provider/notes/$1.md")"
  echo "$metadata" | yq r - "$2"
}

echo "<h2>Notes - Lexigraphy Ordered</h2>"
echo "<ul>"
for note in $notes; do
  # todo: yikes! need to fix this

  echo "<li><a href=$note/>$(get_meta_field "$note" 'title')</a>"
  echo " - $(date --date "$(get_meta_field "$note" 'updated')" "+$date_format")"
  echo "</li>"
done
echo "</ul>"
